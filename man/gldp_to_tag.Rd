% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/gldp_to_tag.R
\name{gldp_to_tag}
\alias{gldp_to_tag}
\title{Convert GeoLocator Data Package to GeoPressureR tag object(s)}
\usage{
gldp_to_tag(pkg, tag_id = NULL)
}
\arguments{
\item{pkg}{A GeoLocator Data Package object (class \code{"geolocatordp"}), typically created with
\code{\link[=read_gldp]{read_gldp()}} or \code{\link[=create_gldp]{create_gldp()}}.}

\item{tag_id}{Character vector specifying which tag(s) to extract. If \code{NULL} (default), all
tags in the package are converted.}
}
\value{
If \code{tag_id} is a single value or if the package contains only one tag, returns a single
GeoPressureR \code{tag} object. Otherwise, returns a named list of \code{tag} objects, where names
correspond to the \code{tag_id} values.

A GeoPressureR \code{tag} object contains:
\itemize{
\item \code{param}: parameter object (see \code{\link[GeoPressureR:param_create]{GeoPressureR::param_create()}})
\item \code{pressure}: data.frame with columns \code{date} and \code{value} (if pressure data available)
\item \code{light}: data.frame with columns \code{date} and \code{value} (if light data available)
\item \code{acceleration}: data.frame with columns \code{date}, \code{value} (activity measure), and optionally
\code{pitch} (if activity/pitch data available)
\item \code{temperature_external}: data.frame with columns \code{date} and \code{value}
(if external temperature data available)
\item \code{temperature_internal}: data.frame with columns \code{date} and \code{value}
(if internal temperature data available)
\item \code{magnetic}: data.frame with columns \code{date}, \code{magnetic_x}, \code{magnetic_y}, \code{magnetic_z}
(if magnetic data available)
\item \code{stap}: data.frame with columns \code{stap_id}, \code{start}, \code{end}, and optionally \code{known_lat},
\code{known_lon}, \code{include} (if stationary periods defined)
\item \code{twilight}: data.frame with columns \code{twilight}, \code{rise}, and optionally \code{label}
(if twilight data available)
}
}
\description{
This function converts a GeoLocator Data Package (gldp) object to one or more GeoPressureR
\code{tag} objects. The gldp structure contains data for potentially multiple tags, while each
GeoPressureR \code{tag} object represents a single tag's sensor data.
}
\details{
The function extracts sensor data from the gldp's \code{measurements} resource and converts it
to the format expected by GeoPressureR. The conversion includes:
\itemize{
\item Filtering measurements by \code{tag_id}
\item Reshaping data from long format (measurements) to wide format (sensor-specific data.frames)
\item Combining related sensors (e.g., \code{activity} and \code{pitch} into \code{acceleration};
\code{magnetic_x/y/z} into \code{magnetic})
\item Adding stationary period (\code{stap}) data if available in the package
\item Adding twilight data if available in the package
\item Setting appropriate parameter values from the gldp metadata
}

\strong{Sensor mapping from GLDP to GeoPressureR:}
\itemize{
\item \code{pressure} → \code{pressure} (date, value)
\item \code{light} → \code{light} (date, value)
\item \code{activity} + \code{pitch} → \code{acceleration} (date, value, pitch) where value = activity
\item \code{temperature-external} → \code{temperature_external} (date, value)
\item \code{temperature-internal} → \code{temperature_internal} (date, value)
\item \code{magnetic_x/y/z} → \code{magnetic} (date, magnetic_x, magnetic_y, magnetic_z)
}

\strong{Additional data extracted:}
\itemize{
\item \code{staps} table → \code{tag$stap} (stap_id, start, end, known_lat, known_lon, include)
\item \code{twilights} table → \code{tag$twilight} (twilight, rise, label)
}

Note that the resulting \code{tag} object will have \code{manufacturer = "datapackage"} in its
parameters, consistent with how GeoPressureR handles data from GeoLocator Data Packages.
}
\examples{
\dontrun{
# Read a gldp from a file
pkg <- read_gldp("path/to/datapackage.json")

# Convert all tags
tags <- gldp_to_tag(pkg)

# Convert a specific tag
tag <- gldp_to_tag(pkg, tag_id = "18LX")

# Convert multiple specific tags
tags <- gldp_to_tag(pkg, tag_id = c("18LX", "18IC"))
}

}
\seealso{
\itemize{
\item \code{\link[=read_gldp]{read_gldp()}} for reading a GeoLocator Data Package
\item \code{\link[GeoPressureR:tag_create]{GeoPressureR::tag_create()}} for creating tag objects from raw files
\item \href{https://raphaelnussbaumer.com/GeoPressureR/}{GeoPressureR documentation}
}
}
