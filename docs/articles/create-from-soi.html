<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Create from SOI • GeoLocatoR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="create-from-soi_files/libs/quarto-html/popper.min.js"></script><script src="create-from-soi_files/libs/quarto-html/tippy.umd.min.js"></script><link href="create-from-soi_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="create-from-soi_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Create from SOI">
<meta property="og:image" content="https://github.com/rafnuss/geolocator/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">GeoLocatoR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-user-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">User Guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-user-guides">
<li><h6 class="dropdown-header" data-toc-skip>Create Data Package</h6></li>
    <li><a class="dropdown-item" href="../articles/create-from-geopressuretemplate.html">from GeoPressureTemplate</a></li>
    <li><a class="dropdown-item" href="../articles/create-from-soi.html">from Swiss Ornithological Institute (SOI)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/read-and-use-datapackage.html">Read and Use Data Package</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://raphaelnussbaumer.com/GeoLocator-DP/">GeolocatorDP</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="https://github.com/rafnuss/geolocator/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Create from SOI</h1>




      <small class="dont-index">Source: <a href="https://github.com/rafnuss/geolocator/blob/HEAD/vignettes/create-from-soi.qmd"><code>vignettes/create-from-soi.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <p>In this vignette, we will cover the main steps involved in the creation of the Core GeoLocator Data Package (i.e., before analysis) with the Swiss Ornitholigical Institute data, starting from the placement of order. Here are the mains steps, with the corresponding code provided below:</p>
<p><strong>1. Placing order</strong></p>
<p>Ask collaborator to enter basic metadata information on the project by creating a <a href="https://raphaelnussbaumer.com/GeoLocator-DP/datapackage/" class="external-link"><code>datapackage.json</code></a>:</p>
<ul>
<li><a href="https://raphaelnussbaumer.com/GeoLocator-DP/datapackage/#title" class="external-link"><code>title</code></a></li>
<li>
<a href="https://raphaelnussbaumer.com/GeoLocator-DP/datapackage/#constributors" class="external-link"><code>constributors</code></a>: including email to define who has access to the private Zenodo during embargo</li>
<li>
<a href="https://raphaelnussbaumer.com/GeoLocator-DP/datapackage/#licences" class="external-link"><code>licences</code></a>: <a href="https://creativecommons.org/licenses/by/4.0/" class="external-link">CC-BY-4.0</a> by default.</li>
<li><a href="https://raphaelnussbaumer.com/GeoLocator-DP/datapackage/#embargo" class="external-link"><code>embargo</code></a></li>
</ul>
<div>
<blockquote>
<p><strong>Tip</strong></p>
<p>This can be done with <code><a href="../reference/create_gldp.html">GeoLocatoR::create_gldp()</a></code> (see below) or using <a href="https://gist.github.com/Rafnuss/457b9096a4fc0ad004115df1712a8923" class="external-link">this datapackage.json template file</a>.</p>
</blockquote>
</div>
<p><strong>2. Sending geolocator together with pre-filled <code>tags.csv</code> and <code>observations.csv</code></strong></p>
<p>Provide basic instructions to ringers/collaborator on how to fill these csv filer with link to the documentation: <a href="https://raphaelnussbaumer.com/GeoLocator-DP/core/tags/" class="external-link"><code>tags.csv</code></a> and <a href="https://raphaelnussbaumer.com/GeoLocator-DP/core/observations/" class="external-link"><code>observations.csv</code></a>:</p>
<div>
<blockquote>
<p><strong>Caution</strong></p>
<ul>
<li>Do not modify columns header, do not add or remove column.</li>
<li>Make sure to fill all required fields (marked by <code>*</code> in documentations)</li>
<li>Each tags should be presents only once in <code>tags.csv</code> and at least one in <code>observations.csv</code> with <code>observation_type: "equipment"</code>.</li>
<li>You will only have access to the data when these two tables are returned complete.</li>
</ul>
</blockquote>
</div>
<p>It is strongly recommended to generate these two files with <code><a href="../reference/add_gldp_soi.html">add_gldp_soi()</a></code> with pre-filled field based on the access database (see below).</p>
<p><strong>3. Processing returned data</strong></p>
<p>Upon reception of the geolocator:</p>
<ul>
<li>Extract geolocator data and store the data (as usual) on the <code>Z:</code> drive.</li>
<li>Add also the filled <code>tags.csv</code> and <code>observations.csv</code> in the same folder</li>
<li>Create the first <em>core</em> DataPackage with <code><a href="../reference/add_gldp_soi.html">add_gldp_soi()</a></code> in any temporary drive (see below)</li>
<li>Upload on <a href="https://help.zenodo.org/docs/deposit/create-new-upload/" class="external-link">Zenodo</a>
</li>
<li>Share access right to contributors based on their urls.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/frictionlessdata/frictionless-r" class="external-link">frictionless</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rafnuss/geolocator">GeoLocatoR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/writexl/" class="external-link">writexl</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org" class="external-link">readxl</a></span><span class="op">)</span></span></code></pre></div>
</div>
<section class="level2"><h2 id="initiate-datapackage-with-datapackage-json">1. Initiate DataPackage with <code>datapackage.json</code>
<a class="anchor" aria-label="anchor" href="#initiate-datapackage-with-datapackage-json"></a>
</h2>
<p>In the contract/agreement, the following terms should be specify:</p>
<ul>
<li>List of contributor with email giving them access write to the datapackage on zenodo while still under embargo</li>
<li>Licenses of the data according to agreement</li>
<li>Embargo date according to agreement</li>
</ul>
<p>Here is a simple example to create a geolocator data package based on these basic information:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pkg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_gldp.html">create_gldp</a></span><span class="op">(</span></span>
<span>  title <span class="op">=</span> <span class="st">"Geolocator study of {species_name} in {location}"</span>, <span class="co"># required</span></span>
<span>  contributors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="co"># required</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      title <span class="op">=</span> <span class="st">"Raphaël Nussbaumer"</span>,</span>
<span>      roles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ContactPerson"</span>, <span class="st">"DataCurator"</span>, <span class="st">"ProjectLeader"</span><span class="op">)</span>,</span>
<span>      email <span class="op">=</span> <span class="st">"raphael.nussbaumer@vogelwarte.ch"</span>,</span>
<span>      path <span class="op">=</span> <span class="st">"https://orcid.org/0000-0002-8185-1020"</span>,</span>
<span>      organization <span class="op">=</span> <span class="st">"Swiss Ornithological Institute"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      title <span class="op">=</span> <span class="st">"Yann Rime"</span>,</span>
<span>      roles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Researcher"</span><span class="op">)</span>,</span>
<span>      email <span class="op">=</span> <span class="st">"yann.rimme@vogelwarte.ch"</span>,</span>
<span>      path <span class="op">=</span> <span class="st">"https://orcid.org/0009-0005-7264-6753"</span>,</span>
<span>      organization <span class="op">=</span> <span class="st">"Swiss Ornithological Institute"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="co"># The default licenses is a Creative Common</span></span>
<span>  licenses <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"CC-BY-4.0"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Creative Commons Attribution 4.0"</span>,</span>
<span>    path <span class="op">=</span> <span class="st">"https://creativecommons.org/licenses/by/4.0/"</span></span>
<span>  <span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="co"># This is the default value, set to a past date so that there are no embargo</span></span>
<span>  embargo <span class="op">=</span> <span class="st">"1970-01-01"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>Read <a href="https://raphaelnussbaumer.com/GeoLocator-DP/datapackage/" class="external-link">the datapackage specification</a> to learn about all recommended metadata that can be added. They can be added in <code><a href="../reference/create_gldp.html">create_gldp()</a></code> or update manually on <code>pkg</code> directly as below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Description is really important to provide some textual background information on the project.</span></span>
<span><span class="va">pkg</span><span class="op">$</span><span class="va">description</span> <span class="op">&lt;-</span> <span class="st">"Geolocator study of Mangrove Kingfisher and Red-capped Robin-chat on the coast of Kenya"</span></span>
<span><span class="co"># If you have a website link, it's quite a nice way to link them up</span></span>
<span><span class="va">pkg</span><span class="op">$</span><span class="va">homepage</span> <span class="op">&lt;-</span> <span class="st">"https://github.com/Rafnuss/MK-RCRC"</span></span>
<span><span class="co"># And the url to an image describing your datapackage</span></span>
<span><span class="va">pkg</span><span class="op">$</span><span class="va">image</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="co"># Versioning of the datapackage is a good idea to allow update of new data.</span></span>
<span><span class="va">pkg</span><span class="op">$</span><span class="va">version</span> <span class="op">&lt;-</span> <span class="st">"1.0.0"</span></span>
<span><span class="co"># You can also add keywords:</span></span>
<span><span class="va">pkg</span><span class="op">$</span><span class="va">keywords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Mangrove Kingfisher"</span>, <span class="st">"Red-capped Robin Chat"</span>, <span class="st">"multi-sensor geolocator"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Important field for publication/researcher</span></span>
<span><span class="co"># By default, the licenses of the data is Creative Common BY 4.0.</span></span>
<span><span class="co"># pkg$licenses</span></span>
<span><span class="co"># Add DOI of the datapackage if already available or reserve it https://help.zenodo.org/docs/deposit/describe-records/reserve-doi/#reserve-doi</span></span>
<span><span class="va">pkg</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="st">"https://doi.org/10.5281/zenodo.11207141"</span></span>
<span><span class="co"># Provide the recommended citation for the package</span></span>
<span><span class="va">pkg</span><span class="op">$</span><span class="va">citation</span> <span class="op">&lt;-</span> <span class="st">"Nussbaumer, R., &amp; Rime, Y. (2024). Woodland Kingfisher: Migration route and timing of South African Woodland Kingfisher (v1.1). Zenodo. https://doi.org/10.5281/zenodo.11207141"</span></span>
<span><span class="co"># Funding sources</span></span>
<span><span class="va">pkg</span><span class="op">$</span><span class="va">grants</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Swiss Ornithological Intitute"</span><span class="op">)</span></span>
<span><span class="co"># Identifiers of resources related to the package (e.g. papers, project pages, derived datasets, APIs, etc.).</span></span>
<span><span class="va">pkg</span><span class="op">$</span><span class="va">relatedIdentifiers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Nussbaumer, R., Jackson, C. Using geolocators to unravel intra-African migrant strategies. http://dx.doi.org/10.13140/RG.2.2.34477.10721 "</span><span class="op">)</span></span>
<span><span class="co"># List of references related to the package</span></span>
<span><span class="va">pkg</span><span class="op">$</span><span class="va">references</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span></code></pre></div>
</div>
<p>Once you’re done, you can visual them</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">pkg</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pkg</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"resources"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
<p>You can export it as <code>datapackage.json</code> with:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">package_json</span> <span class="op">&lt;-</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="va">pkg</span>, pretty <span class="op">=</span> <span class="cn">TRUE</span>, null <span class="op">=</span> <span class="st">"null"</span>, na <span class="op">=</span> <span class="st">"null"</span>, auto_unbox <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/write.html" class="external-link">write</a></span><span class="op">(</span><span class="va">package_json</span>, <span class="st">"datapackage.json"</span><span class="op">)</span></span></code></pre></div>
</div>
<div>
<blockquote>
<p><strong>Tip</strong></p>
<p>Save this file in the root of the project folder on the <code>Z:</code> drive</p>
</blockquote>
</div>
</section><section class="level2"><h2 id="create-pre-filled-tags-csv-and-observations-csv-from-soi-database-no-data">2. Create pre-filled <code>tags.csv</code> and <code>observations.csv</code> from SOI database (no data)<a class="anchor" aria-label="anchor" href="#create-pre-filled-tags-csv-and-observations-csv-from-soi-database-no-data"></a>
</h2>
<p>First, we need to extract the data from the access database.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Root folder of the dataset (typically the Z-drive)</span></span>
<span><span class="va">soi_data_directory</span> <span class="op">&lt;-</span> <span class="st">"/Users/rafnuss/Library/CloudStorage/Box-Box/geolocator_data/UNIT_Vogelzug/"</span></span>
<span></span>
<span><span class="co"># Load the geolocator (GDL) database from the access file</span></span>
<span><span class="va">gdl0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_gdl.html">read_gdl</a></span><span class="op">(</span>access_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">soi_data_directory</span>, <span class="st">"database/GDL_Data.accdb"</span><span class="op">)</span>, filter_col <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: One or more parsing issues, call `problems()` on your data frame for details,</span></span>
<span><span class="co">#&gt; e.g.:</span></span>
<span><span class="co">#&gt;   dat &lt;- vroom(...)</span></span>
<span><span class="co">#&gt;   problems(dat)</span></span></code></pre></div>
</div>
<p>For this example, we will take the geolocator data from the order <code>OtuScoES24</code> and add them to the <code>pk</code> created earlier.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pkg</span> <span class="op">&lt;-</span> <span class="va">pkg</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_gldp_soi.html">add_gldp_soi</a></span><span class="op">(</span></span>
<span>    gdl <span class="op">=</span> <span class="va">gdl0</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">OrderName</span>, <span class="st">"OtuScoES24"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    directory_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">soi_data_directory</span>, <span class="st">"data"</span><span class="op">)</span>,</span>
<span>    allow_empty_o <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># This is required to create an empty observation table</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Warning: We could not find the data directory for 49 tags (out of 49). GDL_IDs: 32TK,</span></span>
<span><span class="co">#&gt; 32OD, 32UE, 32TI, 32OQ, 32SL, 32SV, 32OU, 32UF, 32TJ, 32PJ, 32UX, 32OR, 32OT,</span></span>
<span><span class="co">#&gt; 32TM, 32NK, 32PI, 32UV, …, 32SS, and 32NL. These will not be imported.</span></span></code></pre></div>
</div>
<p>A warning message should confirm that no data is available in the dataset. However, as we have allowed to create an empty observations table with <code>allow_empty_o</code>.</p>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>In this example we used the initial datapackage <code>pkg</code>, but if you want to use an existing <code>datapackage.json</code>, you can you can create the package <code>pkg</code> with</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pkg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_gldp.html">read_gldp</a></span><span class="op">(</span><span class="st">"https://gist.githubusercontent.com/Rafnuss/457b9096a4fc0ad004115df1712a8923/raw/46d5d6e4461f919f725961b037199f4fcf8313b0/datapackage.json"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: `file`</span></span>
<span><span class="co">#&gt; 'https://gist.githubusercontent.com/Rafnuss/457b9096a4fc0ad004115df1712a8923/raw/46d5d6e4461f919f725961b037199f4fcf8313b0/datapackage.json'</span></span>
<span><span class="co">#&gt; should have a resources property containing at least one resource.</span></span>
<span><span class="co">#&gt; ℹ Use `add_resource()` to add resources.</span></span></code></pre></div>
</div>
<p>The warning message is normal, it’s reminding you that the package is actually empty.</p>
</blockquote>
</div>
<p>As the geolocator have just been built and ready to be ship, you can generate the <code>observations.xlsx</code> and <code>tags.xlsx</code> table to be sent to the ringers. I suggest to create a <code>.xlsx</code> spreadsheet and not <code>.csv</code> to preserve the column class.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/writexl/reference/write_xlsx.html" class="external-link">write_xlsx</a></span><span class="op">(</span><span class="fu"><a href="../reference/tags.html">tags</a></span><span class="op">(</span><span class="va">pkg</span><span class="op">)</span>, <span class="st">"./tags.xlsx"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/writexl/reference/write_xlsx.html" class="external-link">write_xlsx</a></span><span class="op">(</span><span class="fu"><a href="../reference/observations.html">observations</a></span><span class="op">(</span><span class="va">pkg</span><span class="op">)</span>, <span class="st">"./observations.xlsx"</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level2"><h2 id="create-core-datapackage-with-data-from-soi-database">3. Create <em>core</em> DataPackage with data from SOI database<a class="anchor" aria-label="anchor" href="#create-core-datapackage-with-data-from-soi-database"></a>
</h2>
<p>If we have data available on the <code>Z:</code> drive, we can use the same function <code><a href="../reference/add_gldp_soi.html">add_gldp_soi()</a></code> to add the three core resources on <code>pkg</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Initiate pkg with a minimalist metadata, use exisiting datapackage.json if possible</span></span>
<span><span class="va">pkg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_gldp.html">create_gldp</a></span><span class="op">(</span></span>
<span>  title <span class="op">=</span> <span class="st">"Geolocator data of Cossypha natalensis in Kenya"</span>,</span>
<span>  contributors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      title <span class="op">=</span> <span class="st">"Raphaël Nussbaumer"</span>,</span>
<span>      roles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ContactPerson"</span>, <span class="st">"DataCurator"</span>, <span class="st">"ProjectLeader"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">pkg</span> <span class="op">&lt;-</span> <span class="va">pkg</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/add_gldp_soi.html">add_gldp_soi</a></span><span class="op">(</span></span>
<span>  gdl <span class="op">=</span> <span class="va">gdl0</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">OrderName</span>, <span class="st">"CosNatKE"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  directory_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">soi_data_directory</span>, <span class="st">"data"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: We could not find the data directory for 55 tags (out of 65). GDL_IDs: 27MK,</span></span>
<span><span class="co">#&gt; 27LF, 27LC, 27MM, 27ML, 27MO, 27LE, 24SX, 24SW, 24SY, 26YC, 26YE, 28AF, 28CF,</span></span>
<span><span class="co">#&gt; 28BE, 28BG, 28BF, 28BH, …, 32YS, and 30IJ. These will not be imported.</span></span>
<span><span class="co">#&gt; ⠙ 4/10 ETA:  7s |</span></span>
<span><span class="co">#&gt; ⠹ 5/10 ETA:  6s |</span></span>
<span><span class="co">#&gt; ⠸ 7/10 ETA:  4s |</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pkg</span><span class="op">)</span></span>
<span><span class="co">#&gt; A GeoLocator Data Package with 3 resourcess:</span></span>
<span><span class="co">#&gt; • tags</span></span>
<span><span class="co">#&gt; • measurements</span></span>
<span><span class="co">#&gt; • observations</span></span>
<span><span class="co">#&gt; Use `unclass()` to print the Data Package as a list.</span></span></code></pre></div>
</div>
<p>Whenever you add some new resources to a datapackage, <code>gldp_update()</code> should be called so that the following field are updated <code>created</code>, <code>temporal</code>, <code>reference_location</code>, <code>taxonomic</code></p>
</section><section class="level2"><h2 id="update-tags-andor-observations-table">4. Update <code>tags</code> and/or <code>observations</code> table<a class="anchor" aria-label="anchor" href="#update-tags-andor-observations-table"></a>
</h2>
<p>There are different way to modify your resources table.</p>
<ul>
<li>In the ideal case, <code>tags.csv</code> and <code>observations.csv</code> have been returned by the ringer. In this case you can simply replace them with</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tags.html">tags</a></span><span class="op">(</span><span class="va">pkg</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"tags.csv"</span><span class="op">)</span> <span class="co"># or read_xlsx()</span></span>
<span><span class="fu">observation</span><span class="op">(</span><span class="va">pkg</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"observations.csv"</span><span class="op">)</span></span></code></pre></div>
</div>
<ul>
<li>In other case, you might want to edit the default table. I suggest to create a temporary <code>.xlsx</code> spreadsheet (and not <code>.csv</code> to preserve the column class), modify it in excel, and read it back into R. You can also edit the tibble directly with <code>dplyr</code> functions.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".xlsx"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/writexl/reference/write_xlsx.html" class="external-link">write_xlsx</a></span><span class="op">(</span><span class="fu"><a href="../reference/tags.html">tags</a></span><span class="op">(</span><span class="va">pkg</span><span class="op">)</span>, <span class="va">temp_file</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"open"</span>, <span class="va">temp_file</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Edit it on the external program and once you're done, save you file and update the table</span></span>
<span><span class="fu"><a href="../reference/tags.html">tags</a></span><span class="op">(</span><span class="va">pkg</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_xlsx</a></span><span class="op">(</span><span class="va">temp_file</span><span class="op">)</span></span></code></pre></div>
</div>
<ul>
<li>Finally, you can also modify the table (not recommended). For this vignette, I’ll just randomly create value for the two required field <code>scientific_name</code> and <code>ring_number</code>
</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tags.html">tags</a></span><span class="op">(</span><span class="va">pkg</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tags.html">tags</a></span><span class="op">(</span><span class="va">pkg</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    scientific_name <span class="op">=</span> <span class="st">"Cossypha natalensis"</span>,</span>
<span>    ring_number <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">ring_number</span><span class="op">)</span>, <span class="st">"XXXXX"</span>, <span class="va">ring_number</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="../reference/observations.html">observations</a></span><span class="op">(</span><span class="va">pkg</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/observations.html">observations</a></span><span class="op">(</span><span class="va">pkg</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    ring_number <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">ring_number</span><span class="op">)</span>, <span class="st">"XXXXX"</span>, <span class="va">ring_number</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div>
<blockquote>
<p><strong>Warning</strong></p>
<p>Don’t forget to update the meta-data information of your Data Package when you’ve updated any tables</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pkg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/update_gldp.html">update_gldp</a></span><span class="op">(</span><span class="va">pkg</span><span class="op">)</span></span></code></pre></div>
</div>
</blockquote>
</div>
</section><section class="level2"><h2 id="check-and-validate-datapackage">5. Check and Validate datapackage<a class="anchor" aria-label="anchor" href="#check-and-validate-datapackage"></a>
</h2>
<p>Before publishing your data, it is essential to validating your GeoLocator Data Package.</p>
<p>A first check can be done with <code><a href="../reference/check_gldp.html">check_gldp()</a></code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_gldp.html">check_gldp</a></span><span class="op">(</span><span class="va">pkg</span><span class="op">)</span></span></code></pre></div>
</div>
<p>The python package <a href="https://github.com/frictionlessdata/frictionless-py" class="external-link"><code>frictionless-py</code></a> offers more advance and general validation.</p>
<p>First you’ll need to <a href="https://www.python.org/downloads/" class="external-link">install python</a> and the frictionless package,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install frictionless</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/validate_gldp.html">validate_gldp</a></span><span class="op">(</span><span class="va">pkg</span>, path <span class="op">=</span> <span class="st">"/Users/rafnuss/anaconda3/bin/"</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level2"><h2 id="write-package-to-directory">6. Write package to directory<a class="anchor" aria-label="anchor" href="#write-package-to-directory"></a>
</h2>
<p>Now that we have confirmed that all the data are correct, we can write the package with</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/frictionless/reference/write_package.html" class="external-link">write_package</a></span><span class="op">(</span><span class="va">pkg</span>, directory <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"~/"</span>, <span class="va">pkg</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div>
<blockquote>
<p><strong>Tip</strong></p>
<p>The folder created can now be uploaded on <a href="https://zenodo.org/uploads/new" class="external-link">Zenodo</a>. All information needed in the upload are provided in <code>datapackage.json</code>!</p>
</blockquote>
</div>
</section><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'light-border',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config);
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Raphaël Nussbaumer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
